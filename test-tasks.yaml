version: "3"

includes:
  build: "build-tasks.yaml"

vars:
  G_TEST_BINARY: "{{.G_BUILD_SPIDER_DIR}}/tests/unitTest"

tasks:
  unit-test:
    deps:
      - task: "build:target"
        vars: {TARGET: "unitTest"}
      - task: "build:target"
        vars: {TARGET: "spider_task_executor"}
      - task: "build:target"
        vars: {TARGET: "worker_test"}
    cmds:
      # Tests tagged with storage requires mysql. Skip them for now.
      - "{{.G_TEST_BINARY}} \"~[storage]\""
