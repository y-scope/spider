version: "3"

vars:
  G_TEST_BINARY: "{{.G_BUILD_SPIDER_DIR}}/tests/unitTest"

tasks:
  unit-test:
    cmds:
      # Add build in cmds to serialize the build
      - task: ":build:target"
        vars: {TARGET: "unitTest"}
      - task: ":build:target"
        vars: {TARGET: "spider_task_executor"}
      - task: ":build:target"
        vars: {TARGET: "worker_test"}
      # Tests tagged with storage requires mysql. Skip them for now.
      - "{{.G_TEST_BINARY}} \"~[storage]\""
