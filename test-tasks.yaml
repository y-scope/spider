version: "3"

vars:
  G_TEST_BINARY: "{{.G_BUILD_SPIDER_DIR}}/tests/unitTest"

tasks:
  unit-test:
    deps: ["build-unit-test"]
    cmds:
      # Tests tagged with storage requires mysql. Skip them for now.
      - "{{.G_TEST_BINARY}} \"~[storage]\""

  build-unit-test:
    internal: true
    # depends on build tool, i.e. make, to check source changes
    deps: [":config-cmake-project"]
    cmds:
      - "cmake --build {{.G_BUILD_SPIDER_DIR}} --target unitTest --parallel"
